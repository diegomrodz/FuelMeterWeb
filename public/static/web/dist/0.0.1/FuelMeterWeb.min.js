/*! FuelMeterWeb 2016-05-19 */
function app_url(a){return APP_URL+"/"+a}function web_url(a){return app_url("web/"+a)}function api_url(a){return app_url("api/"+a)}function api_v1_url(a){return api_url("v1/"+a)}var FuelMeterWeb=angular.module("FuelMeterWeb",["ngRoute","ngMap","datatables"]),APP_URL=$("#APP_URL").val(),CSRF_TOKEN=$("#CSRF_TOKEN").val();FuelMeterWeb.run([function(){}]),FuelMeterWeb.config(["$routeProvider",function(a){a.when("/",{templateUrl:web_url("index"),controller:"IndexCtrl"}).when("/new",{templateUrl:web_url("sample/new"),controller:"NewSampleCtrl"}).when("/data",{templateUrl:web_url("sample/data"),controller:"SampleDataCtrl"}).when("/sample/:sampleId",{templateUrl:web_url("sample/detail"),controller:"SampleDetailCtrl"}).when("/about",{templateUrl:web_url("about")})}]),FuelMeterWeb.controller("FloatingButtonCtrl",["$scope","$rootScope","$location",function(a,b,c){a.isVisible=!1,b.$on("$locationChangeSuccess",function(b){"/"==c.path()?a.isVisible=!0:a.isVisible=!1})}]),FuelMeterWeb.controller("IndexCtrl",["$scope","SampleRepository",function(a,b){a.markers=[],b.all().then(function(b){a.markers=b.data})}]),FuelMeterWeb.controller("NavBarCtrl",["$scope",function(a){a.isCollapsed=!0}]),FuelMeterWeb.controller("NewSampleCtrl",["$scope","$http","$location","AEACService","SampleRepository",function(a,b,c,d,e){a.postSample=function(){var b={};b.name=a.name,b.email=a.email,b.institution=a.institution,b.attendant_name=a.attendantName,b.station_name=a.stationName,b.station_flag=a.stationFlag,b.station_cep=a.stationCep,b.station_address=a.stationAddress,b.station_district=a.stationDistrict,b.station_state=a.stationState,b.station_city=a.stationCity,b.station_lat=a.stationLat,b.station_lng=a.stationLng,b.sample_volume=a.sampleVolume,b.sample_result=a.calcAEAC(a.sampleVolume),b.proceedings=a.proceedings,b.observation=a.observation,e.store(b).then(function(a){c.path("/sample/"+a.data.id)},function(){alert("Houve um erro no envio desta amostra, por favor tentar novamente mais tarde.")})},a.calcAEAC=function(){return a.sampleVolume&&""!=a.sampleVolume?d.calc(a.sampleVolume):""},a.searchCep=function(){if(!a.stationCep||""==a.stationCep)return alert("Por favor, informe o cep para pesquisar o endereço.");var c="https://viacep.com.br/ws/"+a.stationCep+"/json/",d="https://maps.googleapis.com/maps/api/geocode/json?address="+a.stationCep;b({url:c,method:"get",dataType:"json"}).then(function(b){a.stationState=b.data.uf,a.stationCity=b.data.localidade,a.stationDistrict=b.data.bairro,a.stationAddress=b.data.logradouro},function(){alert("Houve um erro na busca do endereço, por favor verifique se o CEP foi informado corretamente")}),b({url:d,method:"get",dataType:"json"}).then(function(b){var c=b.data.results[0];a.stationLat=c.geometry.location.lat,a.stationLng=c.geometry.location.lng},function(){alert("Houve um erro na obtenção das coordenadas geográficas do cep informado.")})}}]),FuelMeterWeb.controller("SampleDataCtrl",["$scope","SampleRepository",function(a,b){a.samples=[],b.all().then(function(b){a.samples=b.data})}]),FuelMeterWeb.controller("SampleDetailCtrl",["$scope","$routeParams","SampleRepository",function(a,b,c){a.sensor={},c.find(b.sampleId).then(function(b){a.sensor=b.data})}]),FuelMeterWeb.service("SampleRepository",["$http",function(a){var b=this;b.find=function(b){return a({url:api_v1_url("sample/"+b),method:"get",dataType:"json"})},b.store=function(b){return a({url:api_v1_url("sample"),method:"post",data:{sample:b,_token:CSRF_TOKEN},dataType:"json"})},b.all=function(b){return a({url:api_v1_url("sample"),method:"get",dataType:"json"})}}]),FuelMeterWeb.service("AEACService",[function(){var a=this;a.calc=function(a){var b=a-50;if(.5>b)return.01;var c=2*b+1;return c>0?c:-c}}]);