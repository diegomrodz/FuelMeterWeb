/*! FuelMeterWeb 2016-06-09 */
function app_url(a){return APP_URL+"/"+a}function web_url(a){return app_url("web/"+a)}function api_url(a){return app_url("api/"+a)}function api_v1_url(a){return api_url("v1/"+a)}var FuelMeterWeb=angular.module("FuelMeterWeb",["ngRoute","ngMap","ngDialog","datatables","file-model","ui.bootstrap"]),APP_URL=$("#APP_URL").val(),CSRF_TOKEN=$("#CSRF_TOKEN").val();FuelMeterWeb.run([function(){}]),FuelMeterWeb.service("AEACService",[function(){var a=this;a.calc=function(a){var b=a-50;if(.5>b)return.01;var c=2*b+1;return c>0?c:-c}}]),FuelMeterWeb.service("CurrentSampleService",[function(){var a=this;a.clear=function(){}}]),FuelMeterWeb.service("SampleRepository",["$http",function(a){var b=this;b.find=function(b){return a({url:api_v1_url("sample/"+b),method:"get",dataType:"json"})},b.store=function(b){return a({url:api_v1_url("sample"),method:"post",data:{sample:b,_token:CSRF_TOKEN},dataType:"json"})},b.all=function(){return a({url:api_v1_url("sample"),method:"get",dataType:"json"})},b.groupBy=function(b){return a({url:api_v1_url("sample?groupBy="+b),method:"get",dataType:"json"})}}]),FuelMeterWeb.controller("FloatingButtonCtrl",["$scope","$rootScope","$location",function(a,b,c){a.isVisible=!1,b.$on("$locationChangeSuccess",function(b){"/"==c.path()?a.isVisible=!0:a.isVisible=!1})}]),FuelMeterWeb.controller("HowToCtrl",["$scope",function(a){}]),FuelMeterWeb.controller("IndexCtrl",["$scope","SampleRepository",function(a,b){a.markers=[],b.groupBy("station_cep").then(function(b){a.markers=b.data})}]),FuelMeterWeb.controller("NavBarCtrl",["$scope",function(a){a.isCollapsed=!0}]),FuelMeterWeb.controller("NewSampleCtrl",["$scope","$http","$location","ngDialog","AEACService","SampleRepository","CurrentSampleService",function(a,b,c,d,e,f,g){a.sample=g,a.whyUndergroundTanks=function(){d.open({template:"whyUndergroundTanks.html",className:"ngdialog-theme-default"})},a.howToKnowTheVolume=function(){d.open({template:"howToKnowTheVolume.html",className:"ngdialog-theme-default"})},a.correctProceedings=function(){d.open({template:"correctProceedings.html",className:"ngdialog-theme-default"})},a.postSample=function(){var b={};b.name=a.sample.name,b.email=a.sample.email,b.institution=a.sample.institution,b.attendant_name=a.sample.attendantName,b.station_name=a.sample.stationName,b.station_flag=a.sample.stationFlag,b.station_cep=a.sample.stationCep,b.underground_tanks_number=a.sample.undergroundTanksNumber,b.station_address=a.sample.stationAddress,b.station_district=a.sample.stationDistrict,b.station_state=a.sample.stationState,b.station_city=a.sample.stationCity,b.station_lat=a.sample.stationLat,b.station_lng=a.sample.stationLng,b.sample_volume=a.sample.sampleVolume,b.sample_result=a.calcAEAC(a.sample.sampleVolume),b.proceedings=a.sample.proceedings,b.observation=a.sample.observation,f.store(b).then(function(a){g.clear(),c.path("/sample/"+a.data.id)},function(){alert("Houve um erro no envio desta amostra, por favor tentar novamente mais tarde.")})},a.calcAEAC=function(){return a.sample.sampleVolume&&""!=a.sample.sampleVolume?e.calc(a.sample.sampleVolume):""},a.searchCep=function(){if(!a.sample.stationCep||""==a.sample.stationCep)return alert("Por favor, informe o cep para pesquisar o endereço.");var c="https://viacep.com.br/ws/"+a.sample.stationCep+"/json/",d="https://maps.googleapis.com/maps/api/geocode/json?address="+a.sample.stationCep;b({url:c,method:"get",dataType:"json"}).then(function(b){a.sample.stationState=b.data.uf,a.sample.stationCity=b.data.localidade,a.sample.stationDistrict=b.data.bairro,a.sample.stationAddress=b.data.logradouro},function(){alert("Houve um erro na busca do endereço, por favor verifique se o CEP foi informado corretamente")}),b({url:d,method:"get",dataType:"json"}).then(function(b){var c=b.data.results[0];a.sample.stationLat=c.geometry.location.lat,a.sample.stationLng=c.geometry.location.lng},function(){alert("Houve um erro na obtenção das coordenadas geográficas do cep informado.")})}}]),FuelMeterWeb.controller("SampleDataCtrl",["$scope","SampleRepository",function(a,b){a.samples=[],b.all().then(function(b){a.samples=b.data})}]),FuelMeterWeb.controller("SampleDetailCtrl",["$scope","$routeParams","SampleRepository",function(a,b,c){a.sensor={},c.find(b.sampleId).then(function(b){a.sensor=b.data})}]),FuelMeterWeb.config(["$routeProvider",function(a){a.when("/",{templateUrl:web_url("index"),controller:"IndexCtrl"}).when("/new",{templateUrl:web_url("sample/new"),controller:"NewSampleCtrl"}).when("/data",{templateUrl:web_url("sample/data"),controller:"SampleDataCtrl"}).when("/how-to",{templateUrl:web_url("how-to"),controller:"HowToCtrl"}).when("/sample/:sampleId",{templateUrl:web_url("sample/detail"),controller:"SampleDetailCtrl"}).when("/about",{templateUrl:web_url("about")})}]);